CREATE USER WOORIDO IDENTIFIED BY "Challenge123!!";

GRANT CONNECT TO WOORIDO;
GRANT RESOURCE TO WOORIDO;
GRANT UNLIMITED TABLESPACE TO WOORIDO;

-- 박대성
CREATE USER DEV_PARK IDENTIFIED BY "WooriDoDreams7!";
GRANT CONNECT TO DEV_PARK;

-- 백승준
CREATE USER DEV_BAEK IDENTIFIED BY "Wooridojundesne123";
GRANT CONNECT TO DEV_BAEK;

-- 이민환
CREATE USER DEV_LEE IDENTIFIED BY "DnflenDnflen123";
GRANT CONNECT TO DEV_LEE;

-- 1. 역할 생성
CREATE ROLE WOORIDO_DEV_ROLE;

-- 2. 팀원들에게 역할 부여
GRANT WOORIDO_DEV_ROLE TO DEV_PARK;
GRANT WOORIDO_DEV_ROLE TO DEV_BAEK;
GRANT WOORIDO_DEV_ROLE TO DEV_LEE;

// 1.1 users (사용자)
CREATE TABLE WOORIDO.USERS (
    ID                           VARCHAR2(36)    PRIMARY KEY,
    EMAIL                        VARCHAR2(100)   UNIQUE NOT NULL,
    PASSWORD_HASH                VARCHAR2(255),
    NAME                         VARCHAR2(50)    NOT NULL,
    NICKNAME                     VARCHAR2(50),
    PHONE                        VARCHAR2(20),
    PROFILE_IMAGE_URL            VARCHAR2(500),
    BIRTH_DATE                   DATE,
    GENDER                       CHAR(1),
    BIO                          VARCHAR2(500),
    IS_VERIFIED                  CHAR(1)         DEFAULT 'N',
    VERIFICATION_TOKEN           VARCHAR2(100),
    VERIFICATION_TOKEN_EXPIRES   TIMESTAMP,
    SOCIAL_PROVIDER              VARCHAR2(20),
    SOCIAL_ID                    VARCHAR2(100),
    PASSWORD_RESET_TOKEN         VARCHAR2(100),
    PASSWORD_RESET_EXPIRES       TIMESTAMP,
    FAILED_LOGIN_ATTEMPTS        NUMBER(10)      DEFAULT 0,
    LOCKED_UNTIL                 TIMESTAMP,
    ACCOUNT_STATUS               VARCHAR2(20)    DEFAULT 'ACTIVE',
    SUSPENDED_AT                 TIMESTAMP,
    SUSPENDED_UNTIL              TIMESTAMP,
    SUSPENSION_REASON            VARCHAR2(500),
    CREATED_AT                   TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT                   TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    LAST_LOGIN_AT                TIMESTAMP,
    AGREED_TERMS                 CHAR(1)         DEFAULT 'N',
    AGREED_PRIVACY               CHAR(1)         DEFAULT 'N',
    AGREED_MARKETING             CHAR(1)         DEFAULT 'N',
    TERMS_AGREED_AT              TIMESTAMP
);

// USERS 인덱스
CREATE UNIQUE INDEX WOORIDO.UK_USERS_NICKNAME ON WOORIDO.USERS(NICKNAME);
CREATE INDEX WOORIDO.IDX_USERS_SOCIAL ON WOORIDO.USERS(SOCIAL_PROVIDER, SOCIAL_ID);
CREATE INDEX WOORIDO.IDX_USERS_ACCOUNT_STATUS ON WOORIDO.USERS(ACCOUNT_STATUS);


// 1.2 accounts (사용자 계좌)
CREATE TABLE WOORIDO.ACCOUNTS (
    ID                 VARCHAR2(36)    PRIMARY KEY,
    USER_ID            VARCHAR2(36)    UNIQUE NOT NULL,
    BALANCE            NUMBER(19)      DEFAULT 0 NOT NULL,
    LOCKED_BALANCE     NUMBER(19)      DEFAULT 0 NOT NULL,
    BANK_CODE          VARCHAR2(10),
    ACCOUNT_NUMBER     VARCHAR2(50),
    ACCOUNT_HOLDER     VARCHAR2(50),
    VERSION            NUMBER(10)      DEFAULT 0 NOT NULL,
    CREATED_AT         TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT         TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_ACCOUNTS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID)
);


// 1.4 user_scores (사용자 당도 점수)
CREATE TABLE WOORIDO.USER_SCORES (
    ID                          VARCHAR2(36)    PRIMARY KEY,
    USER_ID                     VARCHAR2(36)    UNIQUE NOT NULL,
    TOTAL_ATTENDANCE_COUNT      NUMBER(10)      DEFAULT 0,
    TOTAL_PAYMENT_MONTHS        NUMBER(10)      DEFAULT 0,
    TOTAL_OVERDUE_COUNT         NUMBER(10)      DEFAULT 0,
    CONSECUTIVE_OVERDUE_COUNT   NUMBER(10)      DEFAULT 0,
    TOTAL_FEED_COUNT            NUMBER(10)      DEFAULT 0,
    TOTAL_COMMENT_COUNT         NUMBER(10)      DEFAULT 0,
    TOTAL_LIKE_GIVEN_COUNT      NUMBER(10)      DEFAULT 0,
    TOTAL_LEADER_MONTHS         NUMBER(10)      DEFAULT 0,
    TOTAL_VOTE_ABSENCE_COUNT    NUMBER(10)      DEFAULT 0,
    TOTAL_REPORT_RECEIVED_COUNT NUMBER(10)      DEFAULT 0,
    TOTAL_KICK_COUNT            NUMBER(10)      DEFAULT 0,
    PAYMENT_SCORE               NUMBER(10,4)    DEFAULT 0,
    ACTIVITY_SCORE              NUMBER(10,4)    DEFAULT 0,
    TOTAL_SCORE                 NUMBER(10,4)    DEFAULT 12,
    CALCULATED_AT               TIMESTAMP,
    CALCULATED_MONTH            VARCHAR2(7),
    CREATED_AT                  TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT                  TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_USER_SCORES_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_USER_SCORES_TOTAL_SCORE ON WOORIDO.USER_SCORES(TOTAL_SCORE);


// 1.5 refresh_tokens (리프레시 토큰)
CREATE TABLE WOORIDO.REFRESH_TOKENS (
    ID             VARCHAR2(36)    PRIMARY KEY,
    USER_ID        VARCHAR2(36)    NOT NULL,
    TOKEN          VARCHAR2(500)   UNIQUE NOT NULL,
    DEVICE_INFO    VARCHAR2(500),
    IP_ADDRESS     VARCHAR2(45),
    EXPIRES_AT     TIMESTAMP       NOT NULL,
    CREATED_AT     TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    LAST_USED_AT   TIMESTAMP,
    IS_REVOKED     CHAR(1)         DEFAULT 'N',
    CONSTRAINT FK_REFRESH_TOKENS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_REFRESH_TOKENS_USER_ID ON WOORIDO.REFRESH_TOKENS(USER_ID);
CREATE INDEX WOORIDO.IDX_REFRESH_TOKENS_EXPIRES_AT ON WOORIDO.REFRESH_TOKENS(EXPIRES_AT);


// 2.1 challenges (챌린지)
CREATE TABLE WOORIDO.CHALLENGES (
    ID                     VARCHAR2(36)    PRIMARY KEY,
    NAME                   VARCHAR2(100)   NOT NULL,
    DESCRIPTION            VARCHAR2(2000),
    CATEGORY               VARCHAR2(50)    NOT NULL,
    CREATOR_ID             VARCHAR2(36)    NOT NULL,
    LEADER_LAST_ACTIVE_AT  TIMESTAMP,
    LEADER_BENEFIT_RATE    NUMBER(5,4)     DEFAULT 0,
    CURRENT_MEMBERS        NUMBER(10)      DEFAULT 1 NOT NULL,
    MIN_MEMBERS            NUMBER(10)      DEFAULT 3 NOT NULL,
    MAX_MEMBERS            NUMBER(10)      NOT NULL,
    BALANCE                NUMBER(19)      DEFAULT 0 NOT NULL,
    MONTHLY_FEE            NUMBER(19)      NOT NULL,
    DEPOSIT_AMOUNT         NUMBER(19)      NOT NULL,
    STATUS                 VARCHAR2(20)    DEFAULT 'RECRUITING',
    ACTIVATED_AT           TIMESTAMP,
    IS_VERIFIED            CHAR(1)         DEFAULT 'N',
    VERIFIED_AT            TIMESTAMP,
    IS_PUBLIC              CHAR(1)         DEFAULT 'Y',
    THUMBNAIL_URL          VARCHAR2(500),
    BANNER_URL             VARCHAR2(500),
    DELETED_AT             TIMESTAMP,
    DISSOLUTION_REASON     VARCHAR2(500),
    VERSION                NUMBER(10)      DEFAULT 0 NOT NULL,
    CREATED_AT             TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT             TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_CHALLENGES_CREATOR FOREIGN KEY (CREATOR_ID) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_CHALLENGES_CREATOR_ID ON WOORIDO.CHALLENGES(CREATOR_ID);
CREATE INDEX WOORIDO.IDX_CHALLENGES_STATUS ON WOORIDO.CHALLENGES(STATUS);
CREATE INDEX WOORIDO.IDX_CHALLENGES_CATEGORY ON WOORIDO.CHALLENGES(CATEGORY);
CREATE INDEX WOORIDO.IDX_CHALLENGES_IS_PUBLIC ON WOORIDO.CHALLENGES(IS_PUBLIC);


// 2.2 challenge_members (챌린지 멤버)
CREATE TABLE WOORIDO.CHALLENGE_MEMBERS (
    ID                   VARCHAR2(36)    PRIMARY KEY,
    CHALLENGE_ID         VARCHAR2(36)    NOT NULL,
    USER_ID              VARCHAR2(36)    NOT NULL,
    ROLE                 VARCHAR2(20)    DEFAULT 'FOLLOWER',
    DEPOSIT_STATUS       VARCHAR2(20)    DEFAULT 'NONE',
    DEPOSIT_LOCKED_AT    TIMESTAMP,
    DEPOSIT_UNLOCKED_AT  TIMESTAMP,
    ENTRY_FEE_AMOUNT     NUMBER(19)      DEFAULT 0,
    ENTRY_FEE_PAID_AT    TIMESTAMP,
    PRIVILEGE_STATUS     VARCHAR2(20)    DEFAULT 'ACTIVE',
    PRIVILEGE_REVOKED_AT TIMESTAMP,
    LAST_SUPPORT_PAID_AT TIMESTAMP,
    TOTAL_SUPPORT_PAID   NUMBER(19)      DEFAULT 0,
    AUTO_PAY_ENABLED     CHAR(1)         DEFAULT 'Y',
    JOINED_AT            TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    LEFT_AT              TIMESTAMP,
    LEAVE_REASON         VARCHAR2(50),
    CONSTRAINT FK_CHALLENGE_MEMBERS_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES WOORIDO.CHALLENGES(ID),
    CONSTRAINT FK_CHALLENGE_MEMBERS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT UK_CHALLENGE_MEMBERS_CHALLENGE_USER UNIQUE (CHALLENGE_ID, USER_ID)
);

CREATE INDEX WOORIDO.IDX_CHALLENGE_MEMBERS_USER_ID ON WOORIDO.CHALLENGE_MEMBERS(USER_ID);
CREATE INDEX WOORIDO.IDX_CHALLENGE_MEMBERS_ROLE ON WOORIDO.CHALLENGE_MEMBERS(ROLE);


// 1.3 account_transactions (계좌 거래 내역)
CREATE TABLE WOORIDO.ACCOUNT_TRANSACTIONS (
    ID                     VARCHAR2(36)    PRIMARY KEY,
    ACCOUNT_ID             VARCHAR2(36)    NOT NULL,
    TYPE                   VARCHAR2(20)    NOT NULL,
    AMOUNT                 NUMBER(19)      NOT NULL,
    BALANCE_BEFORE         NUMBER(19)      NOT NULL,
    BALANCE_AFTER          NUMBER(19)      NOT NULL,
    LOCKED_BEFORE          NUMBER(19)      NOT NULL,
    LOCKED_AFTER           NUMBER(19)      NOT NULL,
    IDEMPOTENCY_KEY        VARCHAR2(100)   UNIQUE,
    RELATED_CHALLENGE_ID   VARCHAR2(36),
    RELATED_USER_ID        VARCHAR2(36),
    DESCRIPTION            VARCHAR2(500),
    PG_PROVIDER            VARCHAR2(30),
    PG_TX_ID               VARCHAR2(100),
    CREATED_AT             TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_ACCOUNT_TX_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES WOORIDO.ACCOUNTS(ID),
    CONSTRAINT FK_ACCOUNT_TX_CHALLENGE FOREIGN KEY (RELATED_CHALLENGE_ID) REFERENCES WOORIDO.CHALLENGES(ID),
    CONSTRAINT FK_ACCOUNT_TX_USER FOREIGN KEY (RELATED_USER_ID) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_ACCOUNT_TX_ACCOUNT_ID ON WOORIDO.ACCOUNT_TRANSACTIONS(ACCOUNT_ID);
CREATE INDEX WOORIDO.IDX_ACCOUNT_TX_TYPE ON WOORIDO.ACCOUNT_TRANSACTIONS(TYPE);
CREATE INDEX WOORIDO.IDX_ACCOUNT_TX_CREATED_AT ON WOORIDO.ACCOUNT_TRANSACTIONS(CREATED_AT);


// 3.1 meetings (모임)
CREATE TABLE WOORIDO.MEETINGS (
    ID             VARCHAR2(36)    PRIMARY KEY,
    CHALLENGE_ID   VARCHAR2(36)    NOT NULL,
    CREATED_BY     VARCHAR2(36)    NOT NULL,
    TITLE          VARCHAR2(200)   NOT NULL,
    DESCRIPTION    VARCHAR2(2000),
    MEETING_DATE   TIMESTAMP       NOT NULL,
    LOCATION       VARCHAR2(500),
    STATUS         VARCHAR2(20)    DEFAULT 'VOTING',
    CREATED_AT     TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT     TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONFIRMED_AT   TIMESTAMP,
    COMPLETED_AT   TIMESTAMP,
    CONSTRAINT FK_MEETINGS_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES WOORIDO.CHALLENGES(ID),
    CONSTRAINT FK_MEETINGS_CREATOR FOREIGN KEY (CREATED_BY) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_MEETINGS_CHALLENGE_ID ON WOORIDO.MEETINGS(CHALLENGE_ID);
CREATE INDEX WOORIDO.IDX_MEETINGS_STATUS ON WOORIDO.MEETINGS(STATUS);
CREATE INDEX WOORIDO.IDX_MEETINGS_MEETING_DATE ON WOORIDO.MEETINGS(MEETING_DATE);


// 3.2 meeting_votes (모임 참석 투표)
CREATE TABLE WOORIDO.MEETING_VOTES (
    ID             VARCHAR2(36)    PRIMARY KEY,
    MEETING_ID     VARCHAR2(36)    UNIQUE NOT NULL,
    REQUIRED_COUNT NUMBER(10)      NOT NULL,
    ATTEND_COUNT   NUMBER(10)      DEFAULT 0,
    ABSENT_COUNT   NUMBER(10)      DEFAULT 0,
    STATUS         VARCHAR2(20)    DEFAULT 'PENDING',
    VERSION        NUMBER(10)      DEFAULT 0 NOT NULL,
    CREATED_AT     TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    EXPIRES_AT     TIMESTAMP       NOT NULL,
    CLOSED_AT      TIMESTAMP,
    CONSTRAINT FK_MEETING_VOTES_MEETING FOREIGN KEY (MEETING_ID) REFERENCES WOORIDO.MEETINGS(ID)
);

CREATE INDEX WOORIDO.IDX_MEETING_VOTES_STATUS ON WOORIDO.MEETING_VOTES(STATUS);
CREATE INDEX WOORIDO.IDX_MEETING_VOTES_EXPIRES_AT ON WOORIDO.MEETING_VOTES(EXPIRES_AT);


// 3.3 meeting_vote_records (모임 투표 기록)
CREATE TABLE WOORIDO.MEETING_VOTE_RECORDS (
    ID                      VARCHAR2(36)    PRIMARY KEY,
    MEETING_VOTE_ID         VARCHAR2(36)    NOT NULL,
    USER_ID                 VARCHAR2(36)    NOT NULL,
    CHOICE                  VARCHAR2(10)    NOT NULL,
    ACTUAL_ATTENDANCE       VARCHAR2(20)    DEFAULT 'PENDING',
    ATTENDANCE_CONFIRMED_AT TIMESTAMP,
    CREATED_AT              TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_MEETING_VOTE_RECORDS_VOTE FOREIGN KEY (MEETING_VOTE_ID) REFERENCES WOORIDO.MEETING_VOTES(ID),
    CONSTRAINT FK_MEETING_VOTE_RECORDS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT UK_MEETING_VOTE_RECORDS_VOTE_USER UNIQUE (MEETING_VOTE_ID, USER_ID)
);

CREATE INDEX WOORIDO.IDX_MEETING_VOTE_RECORDS_USER_ID ON WOORIDO.MEETING_VOTE_RECORDS(USER_ID);


// 4.1 expense_requests (지출 요청)
CREATE TABLE WOORIDO.EXPENSE_REQUESTS (
    ID           VARCHAR2(36)    PRIMARY KEY,
    MEETING_ID   VARCHAR2(36)    NOT NULL,
    CREATED_BY   VARCHAR2(36)    NOT NULL,
    TITLE        VARCHAR2(200)   NOT NULL,
    AMOUNT       NUMBER(19)      NOT NULL,
    DESCRIPTION  VARCHAR2(2000),
    RECEIPT_URL  VARCHAR2(500),
    STATUS       VARCHAR2(20)    DEFAULT 'VOTING',
    CREATED_AT   TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    APPROVED_AT  TIMESTAMP,
    CONSTRAINT FK_EXPENSE_REQUESTS_MEETING FOREIGN KEY (MEETING_ID) REFERENCES WOORIDO.MEETINGS(ID),
    CONSTRAINT FK_EXPENSE_REQUESTS_CREATOR FOREIGN KEY (CREATED_BY) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_EXPENSE_REQUESTS_MEETING_ID ON WOORIDO.EXPENSE_REQUESTS(MEETING_ID);
CREATE INDEX WOORIDO.IDX_EXPENSE_REQUESTS_STATUS ON WOORIDO.EXPENSE_REQUESTS(STATUS);


// 4.2 expense_votes (지출 투표)
CREATE TABLE WOORIDO.EXPENSE_VOTES (
    ID                 VARCHAR2(36)    PRIMARY KEY,
    EXPENSE_REQUEST_ID VARCHAR2(36)    UNIQUE NOT NULL,
    ELIGIBLE_COUNT     NUMBER(10)      NOT NULL,
    REQUIRED_COUNT     NUMBER(10)      NOT NULL,
    APPROVE_COUNT      NUMBER(10)      DEFAULT 0,
    REJECT_COUNT       NUMBER(10)      DEFAULT 0,
    STATUS             VARCHAR2(20)    DEFAULT 'PENDING',
    VERSION            NUMBER(10)      DEFAULT 0 NOT NULL,
    CREATED_AT         TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    EXPIRES_AT         TIMESTAMP       NOT NULL,
    CLOSED_AT          TIMESTAMP,
    CONSTRAINT FK_EXPENSE_VOTES_REQUEST FOREIGN KEY (EXPENSE_REQUEST_ID) REFERENCES WOORIDO.EXPENSE_REQUESTS(ID)
);

CREATE INDEX WOORIDO.IDX_EXPENSE_VOTES_STATUS ON WOORIDO.EXPENSE_VOTES(STATUS);
CREATE INDEX WOORIDO.IDX_EXPENSE_VOTES_EXPIRES_AT ON WOORIDO.EXPENSE_VOTES(EXPIRES_AT);


// 4.3 expense_vote_records (지출 투표 기록)
CREATE TABLE WOORIDO.EXPENSE_VOTE_RECORDS (
    ID              VARCHAR2(36)    PRIMARY KEY,
    EXPENSE_VOTE_ID VARCHAR2(36)    NOT NULL,
    USER_ID         VARCHAR2(36)    NOT NULL,
    CHOICE          VARCHAR2(10)    NOT NULL,
    "COMMENT"         VARCHAR2(500),
    CREATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_EXPENSE_VOTE_RECORDS_VOTE FOREIGN KEY (EXPENSE_VOTE_ID) REFERENCES WOORIDO.EXPENSE_VOTES(ID),
    CONSTRAINT FK_EXPENSE_VOTE_RECORDS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT UK_EXPENSE_VOTE_RECORDS_VOTE_USER UNIQUE (EXPENSE_VOTE_ID, USER_ID)
);

CREATE INDEX WOORIDO.IDX_EXPENSE_VOTE_RECORDS_USER_ID ON WOORIDO.EXPENSE_VOTE_RECORDS(USER_ID);


// 4.4 payment_barcodes (결제 바코드)
CREATE TABLE WOORIDO.PAYMENT_BARCODES (
    ID                     VARCHAR2(36)    PRIMARY KEY,
    EXPENSE_REQUEST_ID     VARCHAR2(36)    UNIQUE NOT NULL,
    CHALLENGE_ID           VARCHAR2(36)    NOT NULL,
    BARCODE_NUMBER         VARCHAR2(50)    UNIQUE NOT NULL,
    AMOUNT                 NUMBER(19)      NOT NULL,
    STATUS                 VARCHAR2(20)    DEFAULT 'ACTIVE',
    USED_AT                TIMESTAMP,
    USED_MERCHANT_NAME     VARCHAR2(100),
    USED_MERCHANT_CATEGORY VARCHAR2(50),
    PG_TX_ID               VARCHAR2(100),
    EXPIRES_AT             TIMESTAMP       NOT NULL,
    CREATED_AT             TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_PAYMENT_BARCODES_REQUEST FOREIGN KEY (EXPENSE_REQUEST_ID) REFERENCES WOORIDO.EXPENSE_REQUESTS(ID),
    CONSTRAINT FK_PAYMENT_BARCODES_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES WOORIDO.CHALLENGES(ID)
);

CREATE INDEX WOORIDO.IDX_PAYMENT_BARCODES_CHALLENGE_ID ON WOORIDO.PAYMENT_BARCODES(CHALLENGE_ID);
CREATE INDEX WOORIDO.IDX_PAYMENT_BARCODES_STATUS ON WOORIDO.PAYMENT_BARCODES(STATUS);
CREATE INDEX WOORIDO.IDX_PAYMENT_BARCODES_EXPIRES_AT ON WOORIDO.PAYMENT_BARCODES(EXPIRES_AT);


// 4.5 ledger_entries (챌린지 장부)
CREATE TABLE WOORIDO.LEDGER_ENTRIES (
    ID                         VARCHAR2(36)    PRIMARY KEY,
    CHALLENGE_ID               VARCHAR2(36)    NOT NULL,
    TYPE                       VARCHAR2(20)    NOT NULL,
    AMOUNT                     NUMBER(19)      NOT NULL,
    DESCRIPTION                VARCHAR2(500),
    BALANCE_BEFORE             NUMBER(19)      NOT NULL,
    BALANCE_AFTER              NUMBER(19)      NOT NULL,
    RELATED_USER_ID            VARCHAR2(36),
    RELATED_MEETING_ID         VARCHAR2(36),
    RELATED_EXPENSE_REQUEST_ID VARCHAR2(36),
    RELATED_BARCODE_ID         VARCHAR2(36),
    MERCHANT_NAME              VARCHAR2(100),
    MERCHANT_CATEGORY          VARCHAR2(50),
    PG_PROVIDER                VARCHAR2(30),
    PG_APPROVAL_NUMBER         VARCHAR2(50),
    MEMO                       VARCHAR2(500),
    MEMO_UPDATED_AT            TIMESTAMP,
    MEMO_UPDATED_BY            VARCHAR2(36),
    CREATED_AT                 TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_LEDGER_ENTRIES_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES WOORIDO.CHALLENGES(ID),
    CONSTRAINT FK_LEDGER_ENTRIES_USER FOREIGN KEY (RELATED_USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT FK_LEDGER_ENTRIES_MEETING FOREIGN KEY (RELATED_MEETING_ID) REFERENCES WOORIDO.MEETINGS(ID),
    CONSTRAINT FK_LEDGER_ENTRIES_EXPENSE FOREIGN KEY (RELATED_EXPENSE_REQUEST_ID) REFERENCES WOORIDO.EXPENSE_REQUESTS(ID),
    CONSTRAINT FK_LEDGER_ENTRIES_BARCODE FOREIGN KEY (RELATED_BARCODE_ID) REFERENCES WOORIDO.PAYMENT_BARCODES(ID),
    CONSTRAINT FK_LEDGER_ENTRIES_MEMO_BY FOREIGN KEY (MEMO_UPDATED_BY) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_LEDGER_ENTRIES_CHALLENGE_ID ON WOORIDO.LEDGER_ENTRIES(CHALLENGE_ID);
CREATE INDEX WOORIDO.IDX_LEDGER_ENTRIES_TYPE ON WOORIDO.LEDGER_ENTRIES(TYPE);
CREATE INDEX WOORIDO.IDX_LEDGER_ENTRIES_CREATED_AT ON WOORIDO.LEDGER_ENTRIES(CREATED_AT);
CREATE INDEX WOORIDO.IDX_LEDGER_ENTRIES_RELATED_USER_ID ON WOORIDO.LEDGER_ENTRIES(RELATED_USER_ID);


// 4.6 payment_logs (결제 시도/실패 이력)
CREATE TABLE WOORIDO.PAYMENT_LOGS (
    ID                 VARCHAR2(36)    PRIMARY KEY,
    PAYMENT_BARCODE_ID VARCHAR2(36)    NOT NULL,
    ACTION             VARCHAR2(20)    NOT NULL,
    REQUEST_DATA       CLOB,
    RESPONSE_DATA      CLOB,
    ERROR_CODE         VARCHAR2(50),
    ERROR_MESSAGE      VARCHAR2(500),
    CREATED_AT         TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_PAYMENT_LOGS_BARCODE FOREIGN KEY (PAYMENT_BARCODE_ID) REFERENCES WOORIDO.PAYMENT_BARCODES(ID)
);

CREATE INDEX WOORIDO.IDX_PAYMENT_LOGS_BARCODE_ID ON WOORIDO.PAYMENT_LOGS(PAYMENT_BARCODE_ID);
CREATE INDEX WOORIDO.IDX_PAYMENT_LOGS_ACTION ON WOORIDO.PAYMENT_LOGS(ACTION);
CREATE INDEX WOORIDO.IDX_PAYMENT_LOGS_CREATED_AT ON WOORIDO.PAYMENT_LOGS(CREATED_AT);


// 5.1 general_votes (일반 투표)
CREATE TABLE WOORIDO.GENERAL_VOTES (
    ID             VARCHAR2(36)    PRIMARY KEY,
    CHALLENGE_ID   VARCHAR2(36)    NOT NULL,
    CREATED_BY     VARCHAR2(36)    NOT NULL,
    TYPE           VARCHAR2(20)    NOT NULL,
    TITLE          VARCHAR2(200)   NOT NULL,
    DESCRIPTION    VARCHAR2(2000),
    TARGET_USER_ID VARCHAR2(36),
    ELIGIBLE_COUNT NUMBER(10)      NOT NULL,
    REQUIRED_COUNT NUMBER(10)      NOT NULL,
    APPROVE_COUNT  NUMBER(10)      DEFAULT 0,
    REJECT_COUNT   NUMBER(10)      DEFAULT 0,
    STATUS         VARCHAR2(20)    DEFAULT 'PENDING',
    VERSION        NUMBER(10)      DEFAULT 0 NOT NULL,
    CREATED_AT     TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    EXPIRES_AT     TIMESTAMP       NOT NULL,
    CLOSED_AT      TIMESTAMP,
    CONSTRAINT FK_GENERAL_VOTES_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES WOORIDO.CHALLENGES(ID),
    CONSTRAINT FK_GENERAL_VOTES_CREATOR FOREIGN KEY (CREATED_BY) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT FK_GENERAL_VOTES_TARGET FOREIGN KEY (TARGET_USER_ID) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_GENERAL_VOTES_CHALLENGE_ID ON WOORIDO.GENERAL_VOTES(CHALLENGE_ID);
CREATE INDEX WOORIDO.IDX_GENERAL_VOTES_TYPE ON WOORIDO.GENERAL_VOTES(TYPE);
CREATE INDEX WOORIDO.IDX_GENERAL_VOTES_STATUS ON WOORIDO.GENERAL_VOTES(STATUS);
CREATE INDEX WOORIDO.IDX_GENERAL_VOTES_EXPIRES_AT ON WOORIDO.GENERAL_VOTES(EXPIRES_AT);


// 5.2 general_vote_records (일반 투표 기록)
CREATE TABLE WOORIDO.GENERAL_VOTE_RECORDS (
    ID              VARCHAR2(36)    PRIMARY KEY,
    GENERAL_VOTE_ID VARCHAR2(36)    NOT NULL,
    USER_ID         VARCHAR2(36)    NOT NULL,
    CHOICE          VARCHAR2(10)    NOT NULL,
    "COMMENT"         VARCHAR2(500),
    CREATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_GENERAL_VOTE_RECORDS_VOTE FOREIGN KEY (GENERAL_VOTE_ID) REFERENCES WOORIDO.GENERAL_VOTES(ID),
    CONSTRAINT FK_GENERAL_VOTE_RECORDS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT UK_GENERAL_VOTE_RECORDS_VOTE_USER UNIQUE (GENERAL_VOTE_ID, USER_ID)
);

CREATE INDEX WOORIDO.IDX_GENERAL_VOTE_RECORDS_USER_ID ON WOORIDO.GENERAL_VOTE_RECORDS(USER_ID);


// 6.1 posts (피드)
CREATE TABLE WOORIDO.POSTS (
    ID            VARCHAR2(36)    PRIMARY KEY,
    CHALLENGE_ID  VARCHAR2(36),
    CREATED_BY    VARCHAR2(36)    NOT NULL,
    TITLE         VARCHAR2(100),
    CONTENT       VARCHAR2(4000)  NOT NULL,
    CATEGORY      VARCHAR2(20)    DEFAULT 'GENERAL',
    IS_NOTICE     CHAR(1)         DEFAULT 'N',
    IS_PINNED     CHAR(1)         DEFAULT 'N',
    LIKE_COUNT    NUMBER(10)      DEFAULT 0,
    COMMENT_COUNT NUMBER(10)      DEFAULT 0,
    VIEW_COUNT    NUMBER(10)      DEFAULT 0,
    CREATED_AT    TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT    TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    DELETED_AT    TIMESTAMP,
    CONSTRAINT FK_POSTS_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES WOORIDO.CHALLENGES(ID),
    CONSTRAINT FK_POSTS_CREATOR FOREIGN KEY (CREATED_BY) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_POSTS_CHALLENGE_ID ON WOORIDO.POSTS(CHALLENGE_ID);
CREATE INDEX WOORIDO.IDX_POSTS_CREATED_BY ON WOORIDO.POSTS(CREATED_BY);
CREATE INDEX WOORIDO.IDX_POSTS_CREATED_AT ON WOORIDO.POSTS(CREATED_AT);
CREATE INDEX WOORIDO.IDX_POSTS_IS_NOTICE ON WOORIDO.POSTS(IS_NOTICE);
CREATE INDEX WOORIDO.IDX_POSTS_IS_PINNED ON WOORIDO.POSTS(IS_PINNED);


// 6.2 post_images (피드 이미지)
CREATE TABLE WOORIDO.POST_IMAGES (
    ID            VARCHAR2(36)    PRIMARY KEY,
    POST_ID       VARCHAR2(36)    NOT NULL,
    IMAGE_URL     VARCHAR2(500)   NOT NULL,
    DISPLAY_ORDER NUMBER(10)      NOT NULL,
    CREATED_AT    TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_POST_IMAGES_POST FOREIGN KEY (POST_ID) REFERENCES WOORIDO.POSTS(ID)
);

CREATE INDEX WOORIDO.IDX_POST_IMAGES_POST_ID ON WOORIDO.POST_IMAGES(POST_ID);


// 6.3 post_likes (좋아요)
CREATE TABLE WOORIDO.POST_LIKES (
    ID         VARCHAR2(36)    PRIMARY KEY,
    POST_ID    VARCHAR2(36)    NOT NULL,
    USER_ID    VARCHAR2(36)    NOT NULL,
    CREATED_AT TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_POST_LIKES_POST FOREIGN KEY (POST_ID) REFERENCES WOORIDO.POSTS(ID),
    CONSTRAINT FK_POST_LIKES_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT UK_POST_LIKES_POST_USER UNIQUE (POST_ID, USER_ID)
);

CREATE INDEX WOORIDO.IDX_POST_LIKES_USER_ID ON WOORIDO.POST_LIKES(USER_ID);


// 6.4 comments (댓글)
CREATE TABLE WOORIDO.COMMENTS (
    ID         VARCHAR2(36)    PRIMARY KEY,
    POST_ID    VARCHAR2(36)    NOT NULL,
    PARENT_ID  VARCHAR2(36),
    CREATED_BY VARCHAR2(36)    NOT NULL,
    CONTENT    VARCHAR2(1000)  NOT NULL,
    LIKE_COUNT NUMBER(10)      DEFAULT 0,
    CREATED_AT TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    DELETED_AT TIMESTAMP,
    CONSTRAINT FK_COMMENTS_POST FOREIGN KEY (POST_ID) REFERENCES WOORIDO.POSTS(ID),
    CONSTRAINT FK_COMMENTS_PARENT FOREIGN KEY (PARENT_ID) REFERENCES WOORIDO.COMMENTS(ID),
    CONSTRAINT FK_COMMENTS_CREATOR FOREIGN KEY (CREATED_BY) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_COMMENTS_POST_ID ON WOORIDO.COMMENTS(POST_ID);
CREATE INDEX WOORIDO.IDX_COMMENTS_PARENT_ID ON WOORIDO.COMMENTS(PARENT_ID);
CREATE INDEX WOORIDO.IDX_COMMENTS_CREATED_BY ON WOORIDO.COMMENTS(CREATED_BY);


// 6.5 comment_likes (댓글 좋아요)
CREATE TABLE WOORIDO.COMMENT_LIKES (
    ID         VARCHAR2(36)    PRIMARY KEY,
    COMMENT_ID VARCHAR2(36)    NOT NULL,
    USER_ID    VARCHAR2(36)    NOT NULL,
    CREATED_AT TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_COMMENT_LIKES_COMMENT FOREIGN KEY (COMMENT_ID) REFERENCES WOORIDO.COMMENTS(ID),
    CONSTRAINT FK_COMMENT_LIKES_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT UK_COMMENT_LIKES_COMMENT_USER UNIQUE (COMMENT_ID, USER_ID)
);

CREATE INDEX WOORIDO.IDX_COMMENT_LIKES_USER_ID ON WOORIDO.COMMENT_LIKES(USER_ID);


// 7.1 notifications (알림)
CREATE TABLE WOORIDO.NOTIFICATIONS (
    ID                  VARCHAR2(36)    PRIMARY KEY,
    USER_ID             VARCHAR2(36)    NOT NULL,
    TYPE                VARCHAR2(50)    NOT NULL,
    TITLE               VARCHAR2(200)   NOT NULL,
    CONTENT             VARCHAR2(500)   NOT NULL,
    LINK_URL            VARCHAR2(500),
    RELATED_ENTITY_TYPE VARCHAR2(20),
    RELATED_ENTITY_ID   VARCHAR2(36),
    IS_READ             CHAR(1)         DEFAULT 'N',
    READ_AT             TIMESTAMP,
    CREATED_AT          TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_NOTIFICATIONS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_NOTIFICATIONS_USER_ID ON WOORIDO.NOTIFICATIONS(USER_ID);
CREATE INDEX WOORIDO.IDX_NOTIFICATIONS_TYPE ON WOORIDO.NOTIFICATIONS(TYPE);
CREATE INDEX WOORIDO.IDX_NOTIFICATIONS_IS_READ ON WOORIDO.NOTIFICATIONS(IS_READ);
CREATE INDEX WOORIDO.IDX_NOTIFICATIONS_CREATED_AT ON WOORIDO.NOTIFICATIONS(CREATED_AT);


// 7.2 notification_settings (알림 설정)
CREATE TABLE WOORIDO.NOTIFICATION_SETTINGS (
    ID                   VARCHAR2(36)    PRIMARY KEY,
    USER_ID              VARCHAR2(36)    UNIQUE NOT NULL,
    PUSH_ENABLED         CHAR(1)         DEFAULT 'Y',
    EMAIL_ENABLED        CHAR(1)         DEFAULT 'N',
    SMS_ENABLED          CHAR(1)         DEFAULT 'N',
    VOTE_NOTIFICATION    CHAR(1)         DEFAULT 'Y',
    MEETING_NOTIFICATION CHAR(1)         DEFAULT 'Y',
    EXPENSE_NOTIFICATION CHAR(1)         DEFAULT 'Y',
    SNS_NOTIFICATION     CHAR(1)         DEFAULT 'Y',
    SYSTEM_NOTIFICATION  CHAR(1)         DEFAULT 'Y',
    QUIET_HOURS_ENABLED  CHAR(1)         DEFAULT 'N',
    QUIET_HOURS_START    VARCHAR2(5),
    QUIET_HOURS_END      VARCHAR2(5),
    CREATED_AT           TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT           TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_NOTIFICATION_SETTINGS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID)
);


// 7.4 sessions (세션)
CREATE TABLE WOORIDO.SESSIONS (
    ID           VARCHAR2(36)    PRIMARY KEY,
    USER_ID      VARCHAR2(36)    NOT NULL,
    SESSION_TYPE VARCHAR2(20)    NOT NULL,
    RETURN_URL   VARCHAR2(500)   NOT NULL,
    IS_USED      CHAR(1)         DEFAULT 'N',
    CREATED_AT   TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    EXPIRES_AT   TIMESTAMP       NOT NULL,
    CONSTRAINT FK_SESSIONS_USER FOREIGN KEY (USER_ID) REFERENCES WOORIDO.USERS(ID)
);

CREATE INDEX WOORIDO.IDX_SESSIONS_USER_ID ON WOORIDO.SESSIONS(USER_ID);
CREATE INDEX WOORIDO.IDX_SESSIONS_EXPIRES_AT ON WOORIDO.SESSIONS(EXPIRES_AT);


// 7.5 webhook_logs (Webhook 수신 로그)
CREATE TABLE WOORIDO.WEBHOOK_LOGS (
    ID            VARCHAR2(36)    PRIMARY KEY,
    SOURCE        VARCHAR2(30)    NOT NULL,
    EVENT_TYPE    VARCHAR2(50)    NOT NULL,
    EVENT_ID      VARCHAR2(100)   UNIQUE,
    PAYLOAD       CLOB            NOT NULL,
    IS_PROCESSED  CHAR(1)         DEFAULT 'N',
    PROCESSED_AT  TIMESTAMP,
    ERROR_MESSAGE VARCHAR2(500),
    CREATED_AT    TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE INDEX WOORIDO.IDX_WEBHOOK_LOGS_SOURCE ON WOORIDO.WEBHOOK_LOGS(SOURCE);
CREATE INDEX WOORIDO.IDX_WEBHOOK_LOGS_IS_PROCESSED ON WOORIDO.WEBHOOK_LOGS(IS_PROCESSED);
CREATE INDEX WOORIDO.IDX_WEBHOOK_LOGS_CREATED_AT ON WOORIDO.WEBHOOK_LOGS(CREATED_AT);


// 8.1 admins (관리자)
CREATE TABLE WOORIDO.ADMINS (
    ID            VARCHAR2(36)    PRIMARY KEY,
    EMAIL         VARCHAR2(100)   UNIQUE NOT NULL,
    PASSWORD_HASH VARCHAR2(255)   NOT NULL,
    NAME          VARCHAR2(50)    NOT NULL,
    ROLE          VARCHAR2(20)    DEFAULT 'ADMIN',
    IS_ACTIVE     CHAR(1)         DEFAULT 'Y',
    LAST_LOGIN_AT TIMESTAMP,
    CREATED_AT    TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT    TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE INDEX WOORIDO.IDX_ADMINS_ROLE ON WOORIDO.ADMINS(ROLE);
CREATE INDEX WOORIDO.IDX_ADMINS_IS_ACTIVE ON WOORIDO.ADMINS(IS_ACTIVE);


// 7.3 reports (신고) - admins 테이블 생성 후
CREATE TABLE WOORIDO.REPORTS (
    ID                   VARCHAR2(36)    PRIMARY KEY,
    REPORTER_USER_ID     VARCHAR2(36)    NOT NULL,
    REPORTED_USER_ID     VARCHAR2(36)    NOT NULL,
    REPORTED_ENTITY_TYPE VARCHAR2(20)    NOT NULL,
    REPORTED_ENTITY_ID   VARCHAR2(36),
    REASON_CATEGORY      VARCHAR2(50)    NOT NULL,
    REASON_DETAIL        VARCHAR2(500),
    STATUS               VARCHAR2(20)    DEFAULT 'PENDING',
    REVIEWED_AT          TIMESTAMP,
    REVIEWED_BY          VARCHAR2(36),
    ADMIN_NOTE           VARCHAR2(500),
    CREATED_AT           TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_REPORTS_REPORTER FOREIGN KEY (REPORTER_USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT FK_REPORTS_REPORTED FOREIGN KEY (REPORTED_USER_ID) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT FK_REPORTS_REVIEWER FOREIGN KEY (REVIEWED_BY) REFERENCES WOORIDO.ADMINS(ID)
);

CREATE INDEX WOORIDO.IDX_REPORTS_REPORTER_USER_ID ON WOORIDO.REPORTS(REPORTER_USER_ID);
CREATE INDEX WOORIDO.IDX_REPORTS_REPORTED_USER_ID ON WOORIDO.REPORTS(REPORTED_USER_ID);
CREATE INDEX WOORIDO.IDX_REPORTS_STATUS ON WOORIDO.REPORTS(STATUS);
CREATE INDEX WOORIDO.IDX_REPORTS_CREATED_AT ON WOORIDO.REPORTS(CREATED_AT);


// 8.2 fee_policies (수수료 정책)
CREATE TABLE WOORIDO.FEE_POLICIES (
    ID         VARCHAR2(36)    PRIMARY KEY,
    MIN_AMOUNT NUMBER(19)      NOT NULL,
    MAX_AMOUNT NUMBER(19),
    RATE       NUMBER(5,4)     NOT NULL,
    IS_ACTIVE  CHAR(1)         DEFAULT 'Y',
    CREATED_BY VARCHAR2(36),
    CREATED_AT TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_FEE_POLICIES_CREATOR FOREIGN KEY (CREATED_BY) REFERENCES WOORIDO.ADMINS(ID)
);

CREATE INDEX WOORIDO.IDX_FEE_POLICIES_IS_ACTIVE ON WOORIDO.FEE_POLICIES(IS_ACTIVE);


// 8.3 admin_logs (관리자 활동 로그)
CREATE TABLE WOORIDO.ADMIN_LOGS (
    ID          VARCHAR2(36)    PRIMARY KEY,
    ADMIN_ID    VARCHAR2(36),
    ACTION      VARCHAR2(50)    NOT NULL,
    TARGET_TYPE VARCHAR2(20),
    TARGET_ID   VARCHAR2(36),
    DETAILS     CLOB,
    IP_ADDRESS  VARCHAR2(50),
    USER_AGENT  VARCHAR2(500),
    CREATED_AT  TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_ADMIN_LOGS_ADMIN FOREIGN KEY (ADMIN_ID) REFERENCES WOORIDO.ADMINS(ID)
);

CREATE INDEX WOORIDO.IDX_ADMIN_LOGS_ADMIN_ID ON WOORIDO.ADMIN_LOGS(ADMIN_ID);
CREATE INDEX WOORIDO.IDX_ADMIN_LOGS_ACTION ON WOORIDO.ADMIN_LOGS(ACTION);
CREATE INDEX WOORIDO.IDX_ADMIN_LOGS_CREATED_AT ON WOORIDO.ADMIN_LOGS(CREATED_AT);


// 8.4 settlements (정산 관리)
CREATE TABLE WOORIDO.SETTLEMENTS (
    ID               VARCHAR2(36)    PRIMARY KEY,
    CHALLENGE_ID     VARCHAR2(36)    NOT NULL,
    SETTLEMENT_MONTH VARCHAR2(7)     NOT NULL,
    TOTAL_SUPPORT    NUMBER(19)      NOT NULL,
    TOTAL_EXPENSE    NUMBER(19)      NOT NULL,
    TOTAL_FEE        NUMBER(19)      NOT NULL,
    NET_AMOUNT       NUMBER(19)      NOT NULL,
    STATUS           VARCHAR2(20)    DEFAULT 'PENDING',
    SETTLED_AT       TIMESTAMP,
    SETTLED_BY       VARCHAR2(36),
    CREATED_AT       TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT       TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_SETTLEMENTS_CHALLENGE FOREIGN KEY (CHALLENGE_ID) REFERENCES WOORIDO.CHALLENGES(ID),
    CONSTRAINT FK_SETTLEMENTS_SETTLER FOREIGN KEY (SETTLED_BY) REFERENCES WOORIDO.ADMINS(ID),
    CONSTRAINT UK_SETTLEMENTS_CHALLENGE_MONTH UNIQUE (CHALLENGE_ID, SETTLEMENT_MONTH)
);

CREATE INDEX WOORIDO.IDX_SETTLEMENTS_STATUS ON WOORIDO.SETTLEMENTS(STATUS);
CREATE INDEX WOORIDO.IDX_SETTLEMENTS_MONTH ON WOORIDO.SETTLEMENTS(SETTLEMENT_MONTH);


// 8.5 refunds (환불 관리)
CREATE TABLE WOORIDO.REFUNDS (
    ID              VARCHAR2(36)    PRIMARY KEY,
    ACCOUNT_ID      VARCHAR2(36)    NOT NULL,
    ORIGINAL_TX_ID  VARCHAR2(36),
    AMOUNT          NUMBER(19)      NOT NULL,
    REASON_CATEGORY VARCHAR2(50)    NOT NULL,
    REASON_DETAIL   VARCHAR2(500),
    STATUS          VARCHAR2(20)    DEFAULT 'REQUESTED',
    REQUESTED_BY    VARCHAR2(36)    NOT NULL,
    APPROVED_BY     VARCHAR2(36),
    APPROVED_AT     TIMESTAMP,
    REJECTED_BY     VARCHAR2(36),
    REJECTED_AT     TIMESTAMP,
    REJECT_REASON   VARCHAR2(500),
    PG_REFUND_ID    VARCHAR2(100),
    REFUNDED_AT     TIMESTAMP,
    CREATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATED_AT      TIMESTAMP       DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT FK_REFUNDS_ACCOUNT FOREIGN KEY (ACCOUNT_ID) REFERENCES WOORIDO.ACCOUNTS(ID),
    CONSTRAINT FK_REFUNDS_ORIGINAL_TX FOREIGN KEY (ORIGINAL_TX_ID) REFERENCES WOORIDO.ACCOUNT_TRANSACTIONS(ID),
    CONSTRAINT FK_REFUNDS_REQUESTER FOREIGN KEY (REQUESTED_BY) REFERENCES WOORIDO.USERS(ID),
    CONSTRAINT FK_REFUNDS_APPROVER FOREIGN KEY (APPROVED_BY) REFERENCES WOORIDO.ADMINS(ID),
    CONSTRAINT FK_REFUNDS_REJECTER FOREIGN KEY (REJECTED_BY) REFERENCES WOORIDO.ADMINS(ID)
);

CREATE INDEX WOORIDO.IDX_REFUNDS_ACCOUNT_ID ON WOORIDO.REFUNDS(ACCOUNT_ID);
CREATE INDEX WOORIDO.IDX_REFUNDS_STATUS ON WOORIDO.REFUNDS(STATUS);
CREATE INDEX WOORIDO.IDX_REFUNDS_CREATED_AT ON WOORIDO.REFUNDS(CREATED_AT);


// 모든 테이블에 대해 ROLE 권한 부여
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.USERS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.ACCOUNTS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.ACCOUNT_TRANSACTIONS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.USER_SCORES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.REFRESH_TOKENS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.CHALLENGES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.CHALLENGE_MEMBERS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.MEETINGS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.MEETING_VOTES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.MEETING_VOTE_RECORDS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.EXPENSE_REQUESTS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.EXPENSE_VOTES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.EXPENSE_VOTE_RECORDS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.PAYMENT_BARCODES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.LEDGER_ENTRIES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.PAYMENT_LOGS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.GENERAL_VOTES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.GENERAL_VOTE_RECORDS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.POSTS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.POST_IMAGES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.POST_LIKES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.COMMENTS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.COMMENT_LIKES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.NOTIFICATIONS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.NOTIFICATION_SETTINGS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.REPORTS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.SESSIONS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.WEBHOOK_LOGS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.ADMINS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.FEE_POLICIES TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.ADMIN_LOGS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.SETTLEMENTS TO WOORIDO_DEV_ROLE;
GRANT SELECT, INSERT, UPDATE, DELETE ON WOORIDO.REFUNDS TO WOORIDO_DEV_ROLE;